<?php
/**
 * @var \Gab\Dropshipping\Block\Adminhtml\Import $block
 */
?>
<div class="dropshipping-import">
    <h2><?= $block->escapeHtml(__('Import Products from CJ Dropshipping')) ?></h2>

    <div class="search-box">
        <div class="search-field">
            <label for="search-term"><?= $block->escapeHtml(__('Search Products:')) ?></label>
            <input type="text" id="search-term" name="term" placeholder="<?= $block->escapeHtml(__('Enter keywords...')) ?>" />
            <button type="button" id="search-products-btn" class="action-primary"><?= $block->escapeHtml(__('Search')) ?></button>
        </div>
        <div class="search-options">
            <label><?= $block->escapeHtml(__('Categories:')) ?></label>
            <div class="options-container">
                <div class="option">
                    <input type="checkbox" id="cat-relaxation" name="categories[]" value="relaxation" />
                    <label for="cat-relaxation"><?= $block->escapeHtml(__('Relaxation')) ?></label>
                </div>
                <div class="option">
                    <input type="checkbox" id="cat-light-therapy" name="categories[]" value="light-therapy" />
                    <label for="cat-light-therapy"><?= $block->escapeHtml(__('Light Therapy')) ?></label>
                </div>
                <div class="option">
                    <input type="checkbox" id="cat-massage" name="categories[]" value="massage" />
                    <label for="cat-massage"><?= $block->escapeHtml(__('Massage')) ?></label>
                </div>
            </div>
        </div>
    </div>

    <div class="import-instructions">
        <h3><?= $block->escapeHtml(__('How to Import Products')) ?></h3>
        <ol>
            <li><?= $block->escapeHtml(__('Search for products by keywords or browse categories')) ?></li>
            <li><?= $block->escapeHtml(__('Select products from search results')) ?></li>
            <li><?= $block->escapeHtml(__('Configure import settings (pricing, inventory, etc.)')) ?></li>
            <li><?= $block->escapeHtml(__('Click "Import Selected Products"')) ?></li>
        </ol>
        <p><?= $block->escapeHtml(__('Note: Product data will be imported with your configured markup settings from the module configuration.')) ?></p>
    </div>

    <div class="search-results">
        <p class="no-results"><?= $block->escapeHtml(__('Use the search form above to find products.')) ?></p>
        <div id="search-results-container" style="display: none;">
            <div class="products-grid">
                <!-- Products will be loaded here -->
            </div>
            <div class="pagination-container">
                <!-- Pagination will be loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- Formulaire de configuration d'importation (Modal) -->
<div class="form-overlay" id="import-form-overlay"></div>
<div class="import-configuration-form" id="import-configuration-form">
    <div class="form-header">
        <h3><?= $block->escapeHtml(__('Import Configuration')) ?></h3>
        <button type="button" class="close-form" id="close-import-form">&times;</button>
    </div>

    <div class="product-info-preview">
        <div class="product-image-preview">
            <img src="" alt="<?= $block->escapeHtml(__('Product Preview')) ?>" id="product-preview-image">
        </div>
        <div class="product-name-preview" id="product-preview-name"></div>
    </div>

    <div class="form-group">
        <label for="import-type"><?= $block->escapeHtml(__('Import Type:')) ?></label>
        <select id="import-type" name="import_type">
            <option value="simple"><?= $block->escapeHtml(__('Simple Product')) ?></option>
            <option value="configurable"><?= $block->escapeHtml(__('Configurable Product (with variants)')) ?></option>
        </select>
    </div>

    <div class="form-group">
        <label for="markup-percentage"><?= $block->escapeHtml(__('Price Markup (%):')) ?></label>
        <input type="number" id="markup-percentage" name="markup_percentage" value="<?= $block->escapeHtml($block->getMarkupPercentage()) ?>" min="0" max="500" step="1">
    </div>

    <div class="form-group">
        <label for="stock-quantity"><?= $block->escapeHtml(__('Initial Stock Quantity:')) ?></label>
        <input type="number" id="stock-quantity" name="stock_quantity" value="<?= $block->escapeHtml($block->getDefaultStock()) ?>" min="0" step="1">
    </div>

    <div class="form-group">
        <label for="category-ids"><?= $block->escapeHtml(__('Categories:')) ?></label>
        <select id="category-ids" name="category_ids[]" multiple>
            <?php foreach ($block->getCategoryOptions() as $option): ?>
                <option value="<?= $block->escapeHtmlAttr($option['value']) ?>"><?= $block->escapeHtml($option['label']) ?></option>
            <?php endforeach; ?>
        </select>
    </div>

    <div class="form-actions">
        <button type="button" class="action-secondary" id="cancel-import"><?= $block->escapeHtml(__('Cancel')) ?></button>
        <button type="button" class="action-primary" id="confirm-import"><?= $block->escapeHtml(__('Import Product')) ?></button>
    </div>
</div>

<!-- Formulaire de sÃ©lection d'attribut (Modal) -->
<div class="form-overlay" id="attribute-selection-overlay"></div>
<div class="attribute-selection-modal" id="attribute-selection-modal">
    <div class="form-header">
        <h3>Select Configurable Attributes</h3>
        <button type="button" class="close-form" id="close-attribute-modal">&times;</button>
    </div>

    <div class="modal-content">
        <p class="info-text">Select which variant attributes should be configurable options:</p>

        <div id="attributes-list" class="attributes-container">
            <!-- Attributes will be loaded here -->
        </div>

        <div class="selection-summary">
            <span id="selected-count">0</span> attributes selected
        </div>
    </div>

    <div class="form-actions">
        <button type="button" class="action-secondary" id="cancel-attribute-selection">Cancel</button>
        <button type="button" class="action-primary" id="confirm-attribute-selection" disabled>Continue Import</button>
    </div>
</div>

<div class="configurable-info" style="display: none;">
    <p class="info-note">For configurable products, you'll be able to select which variant attributes to use as configurable options.</p>
</div>

<script type="text/x-magento-init">
{
    "*": {
        "Gab_Dropshipping/js/import-products": {
            "searchUrl": "<?= $block->escapeJs($block->getUrl('dropshipping/import/search')) ?>",
            "detailsUrl": "<?= $block->escapeJs($block->getUrl('dropshipping/import/details')) ?>",
            "importUrl": "<?= $block->escapeJs($block->getUrl('dropshipping/import/importProduct')) ?>",
            "getVariantsUrl": "<?= $block->escapeJs($block->getUrl('dropshipping/import/getVariants')) ?>",
            "selectAttributesUrl": "<?= $block->escapeJs($block->getUrl('dropshipping/import/selectAttributes')) ?>",
            "placeholderImage": "<?= $block->escapeJs($block->getViewFileUrl('Gab_Dropshipping::images/product-placeholder.png')) ?>"
        }
    }
}
</script>
